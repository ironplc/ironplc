name: IronPLC End to End Smoke Test

on:
  # Allow triggering directly
  workflow_dispatch:
    inputs:
      version:
        required: true
        type: string
        description: 'The version number to test with (without the "v" prefix)'

      ironplcc-installer-x86_64-windows-filename:
        required: false
        type: string
        description: "File name of the IronPLC compiler installer artifact from GitHub releases"
        default: "ironplcc-x86_64-windows.exe"

      ironplc-vscode-extension-filename:
        required: false
        type: string
        description: "File name of the VS Code Extension artifact from GitHub releases"
        default: "ironplc-vscode-extension.vsix"

      ironplc-vscode-extension-name:
        required: false
        type: string
        description: "The identifier for the Visual Studio Code extension"
        default: "garretfick.ironplc"

  # Allow using this workflow from another workflow
  workflow_call:
    inputs:
      version:
        required: true
        type: string
        description: 'The version number to test with (without the "v" prefix)'

      ironplcc-installer-x86_64-windows-filename:
        required: true
        type: string
        description: "File name of the IronPLC compiler installer artifact from GitHub releases"

      ironplc-vscode-extension-filename:
        required: true
        type: string
        description: "File name of the VS Code Extension artifact from GitHub releases"

      ironplc-vscode-extension-name:
        required: true
        type: string
        description: "The identifier for the Visual Studio Code extension"

jobs:
  endtoend:
    runs-on: windows-latest

    steps:
      - uses: taiki-e/install-action@just
      - uses: actions/checkout@v3

      - name: End to end test
        run: just endtoend-smoke ${{ inputs.version }} ${{ inputs.ironplcc-installer-x86_64-windows-filename }} ${{ inputs.ironplc-vscode-extension-filename }} ${{ ironplc-vscode-extension-name }}
